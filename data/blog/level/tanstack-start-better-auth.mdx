---
title: Tanstack Start Better Auth Setup
date: '11-21-25'
draft: true
---

### Install NPM Package

```bash
npm install better-auth@latest
```

### Set Enviornment Variables

Generate the key with openssl.

```bash
openssl rand -base64 32
```

Then set the environment variable.

```:.env
BETTER_AUTH_SECRET=<generated secret key>
```

Set the base URL.

```:.env
BETTER_AUTH_URL=http://localhost:3000
```

### Create An Instance

```typescript:src/lib/auth.ts
import { betterAuth } from "better-auth";
export const auth = betterAuth({
  //...
});
```

Add the Drizzle adapter.

```typescript:src/lib/auth.ts {2,3,6,7,8}
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { db } from "@/db";

export const auth = betterAuth({
    database: drizzleAdapter(db, {
        provider: "pg",
    }),
});
```

### Schema

Generate the required Better Auth schema.

```bash
npx @better-auth/cli generate
```

That will create a sql file in `better-auth_migrations`. If you have postgres installed on your
local maching you can run the following.

```bash
psql "put your connection string here" -f better-auth_migrations/<name of generated filename>.sql
```

If you don't have postgres installed you can copy the contents of the generated file and paste it
into your Drizzle Studio SQL Console.

### Authentication Method

For this app I'm going to be using email and password authentication.

```typescript:src/lib/auth.ts {10,11,12}
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { db } from "@/db";

export const auth = betterAuth({
	database: drizzleAdapter(db, {
		provider: "pg",
	}),
	emailAndPassword: {
		enabled: true,
	},
});
```

### Mount Handler

Create a catchall api route for Better Auth.

```bash
mkdir -p src/routes/api/auth && touch src/routes/api/auth/$.ts
```

```typescript:src/routes/api/auth/$.ts
import { createFileRoute } from "@tanstack/react-router";
import { auth } from "@/lib/auth";

export const Route = createFileRoute("/api/auth/$")({
	server: {
		handlers: {
			GET: async ({ request }: { request: Request }) => {
				return await auth.handler(request);
			},
			POST: async ({ request }: { request: Request }) => {
				return await auth.handler(request);
			},
		},
	},
});
```

### Create Client Instance

Create a new file `src/lib/auth-client.ts`.

````bash
touch src/lib/auth-client.ts`

```typescript:src/lib/auth-client.ts
import { createAuthClient } from "better-auth/react"
export const authClient = createAuthClient({})
````

### Usage

```typescript:src/lib/auth.ts {3,13}
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { tanstackStartCookies } from "better-auth/tanstack-start";
import { db } from "@/db";

export const auth = betterAuth({
	database: drizzleAdapter(db, {
		provider: "pg",
	}),
	emailAndPassword: {
		enabled: true,
	},
	plugins: [tanstackStartCookies()], // make sure this is the last plugin in the array
});
```
